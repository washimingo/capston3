<!-- Header Component -->
<app-header 
  title="Ayuda y Tips" 
  titleIcon="school-outline">
</app-header>

<!-- Executive Tips Dashboard -->
<ion-content class="executive-dashboard">
  <div class="dashboard-container">
    
    <!-- Dashboard Header Section -->
    <section class="dashboard-header">
      <div class="header-content">
        <div class="title-section">
          <h1 class="text-3xl font-bold text-gray-900">Centro de Aprendizaje</h1>
          <p class="text-lg text-gray-600 mt-2">Tutoriales esenciales para manejarte en la plataforma</p>
        </div>
        
        <!-- Quick Stats -->
        <div class="stats-grid">
          <div class="stat-card bg-blue-50 border-blue-200">
            <div class="stat-icon bg-blue-100 text-blue-600">
              <ion-icon name="book-outline"></ion-icon>
            </div>
            <div class="stat-content">
              <div class="stat-number text-blue-900">{{ totalTutorials }}</div>
              <div class="stat-label text-blue-700">Tutoriales</div>
            </div>
          </div>
          
          <div class="stat-card bg-green-50 border-green-200">
            <div class="stat-icon bg-green-100 text-green-600">
              <ion-icon name="checkmark-circle-outline"></ion-icon>
            </div>
            <div class="stat-content">
              <div class="stat-number text-green-900">{{ completedTutorials }}</div>
              <div class="stat-label text-green-700">Completados</div>
            </div>
          </div>
          
          <div class="stat-card bg-purple-50 border-purple-200">
            <div class="stat-icon bg-purple-100 text-purple-600">
              <ion-icon name="time-outline"></ion-icon>
            </div>
            <div class="stat-content">
              <div class="stat-number text-purple-900">{{ estimatedTime }}</div>
              <div class="stat-label text-purple-700">Min. Promedio</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Search and Filter Section -->
    <section class="search-section">
      <div class="search-container">
        <div class="search-bar-wrapper">
          <ion-searchbar 
            class="executive-searchbar"
            placeholder="Buscar tutoriales..."
            [(ngModel)]="searchTerm"
            (ionInput)="onSearchChange($event)">
          </ion-searchbar>
        </div>
        
        <!-- Category Filters -->
        <div class="filter-chips">
          <ion-chip 
            [class]="selectedCategory === 'all' ? 'chip-active' : 'chip-inactive'"
            (click)="selectCategory('all')">
            <ion-label>Todos</ion-label>
          </ion-chip>
          
          <ion-chip 
            [class]="selectedCategory === 'basico' ? 'chip-active' : 'chip-inactive'"
            (click)="selectCategory('basico')">
            <ion-label>Básico</ion-label>
          </ion-chip>
          
          <ion-chip 
            [class]="selectedCategory === 'facturacion' ? 'chip-active' : 'chip-inactive'"
            (click)="selectCategory('facturacion')">
            <ion-label>Facturación</ion-label>
          </ion-chip>
          
          <ion-chip 
            [class]="selectedCategory === 'reportes' ? 'chip-active' : 'chip-inactive'"
            (click)="selectCategory('reportes')">
            <ion-label>Reportes</ion-label>
          </ion-chip>
          
          <ion-chip 
            [class]="selectedCategory === 'configuracion' ? 'chip-active' : 'chip-inactive'"
            (click)="selectCategory('configuracion')">
            <ion-label>Configuración</ion-label>
          </ion-chip>
        </div>
      </div>
    </section>

    <!-- Tutorials Library Section -->
    <section class="tutorials-library">
      <div class="library-header">
        <h2 class="text-2xl font-semibold text-gray-900">Biblioteca de Tutoriales</h2>
        <div class="view-options">
          <ion-button 
            fill="clear" 
            [class]="viewMode === 'grid' ? 'view-btn-active' : 'view-btn-inactive'"
            (click)="setViewMode('grid')">
            <ion-icon name="grid-outline"></ion-icon>
          </ion-button>
          <ion-button 
            fill="clear" 
            [class]="viewMode === 'list' ? 'view-btn-active' : 'view-btn-inactive'"
            (click)="setViewMode('list')">
            <ion-icon name="list-outline"></ion-icon>
          </ion-button>
        </div>
      </div>

      <!-- Grid View -->
      <div *ngIf="viewMode === 'grid'" class="tutorials-grid">
        <div 
          *ngFor="let tutorial of getFilteredTutorials()" 
          class="tutorial-card executive-card"
          (click)="openTutorial(tutorial)">
          
          <!-- Card Header with Icon -->
          <div class="card-header" [ngClass]="'gradient-' + tutorial.color">
            <div class="header-content">
              <ion-icon [name]="tutorial.icon" class="tutorial-icon"></ion-icon>
              <div class="difficulty-badge" [ngClass]="'badge-' + tutorial.difficulty">
                {{ tutorial.difficulty | titlecase }}
              </div>
            </div>
          </div>

          <!-- Card Body -->
          <div class="card-body">
            <div class="category-tag">{{ tutorial.category | titlecase }}</div>
            <h3 class="tutorial-title">{{ tutorial.title }}</h3>
            <p class="tutorial-description">{{ tutorial.description }}</p>
            
            <!-- Tutorial Meta -->
            <div class="tutorial-meta">
              <div class="meta-item">
                <ion-icon name="time-outline"></ion-icon>
                <span>{{ tutorial.duration }} min</span>
              </div>
              <div class="meta-item">
                <ion-icon name="person-outline"></ion-icon>
                <span>{{ tutorial.level }}</span>
              </div>
            </div>

            <!-- Progress Bar -->
            <div class="progress-section">
              <div class="progress-bar">
                <div 
                  class="progress-fill" 
                  [style.width.%]="tutorial.progress"
                  [ngClass]="'progress-' + tutorial.color">
                </div>
              </div>
              <span class="progress-text">{{ tutorial.progress }}% Completado</span>
            </div>
          </div>

          <!-- Card Footer -->
          <div class="card-footer">
            <ion-button 
              fill="clear" 
              size="small" 
              class="action-button"
              [ngClass]="'btn-' + tutorial.color">
              <ion-icon name="play-outline" slot="start"></ion-icon>
              {{ tutorial.progress > 0 ? 'Continuar' : 'Comenzar' }}
            </ion-button>
          </div>
        </div>
      </div>

      <!-- List View -->
      <div *ngIf="viewMode === 'list'" class="tutorials-list">
        <div 
          *ngFor="let tutorial of getFilteredTutorials()" 
          class="tutorial-row executive-row"
          (click)="openTutorial(tutorial)">
          
          <div class="row-icon" [ngClass]="'icon-' + tutorial.color">
            <ion-icon [name]="tutorial.icon"></ion-icon>
          </div>
          
          <div class="row-content">
            <div class="row-header">
              <h3 class="row-title">{{ tutorial.title }}</h3>
              <div class="row-badges">
                <span class="category-badge">{{ tutorial.category | titlecase }}</span>
                <span class="difficulty-badge" [ngClass]="'badge-' + tutorial.difficulty">
                  {{ tutorial.difficulty | titlecase }}
                </span>
              </div>
            </div>
            <p class="row-description">{{ tutorial.description }}</p>
            <div class="row-meta">
              <span class="meta-item">
                <ion-icon name="time-outline"></ion-icon>
                {{ tutorial.duration }} minutos
              </span>
              <span class="meta-item">
                <ion-icon name="person-outline"></ion-icon>
                {{ tutorial.level }}
              </span>
              <span class="meta-item">
                <ion-icon name="checkmark-circle-outline"></ion-icon>
                {{ tutorial.progress }}% Completado
              </span>
            </div>
          </div>
          
          <div class="row-actions">
            <div class="progress-circle" [ngClass]="'progress-' + tutorial.color">
              <span>{{ tutorial.progress }}%</span>
            </div>
            <ion-button 
              fill="clear" 
              class="action-button"
              [ngClass]="'btn-' + tutorial.color">
              <ion-icon name="play-outline"></ion-icon>
            </ion-button>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="getFilteredTutorials().length === 0" class="empty-state">
        <div class="empty-content">
          <ion-icon name="search-outline" class="empty-icon"></ion-icon>
          <h3 class="empty-title">No se encontraron tutoriales</h3>
          <p class="empty-description">
            Intenta ajustar tu búsqueda o seleccionar una categoría diferente
          </p>
          <ion-button fill="outline" (click)="clearFilters()">
            <ion-icon name="refresh-outline" slot="start"></ion-icon>
            Mostrar Todos
          </ion-button>
        </div>
      </div>
    </section>
  </div>
</ion-content>

<!-- Tutorial Modal -->
<ion-modal #tutorialModal [isOpen]="isModalOpen" (willDismiss)="closeModal()">
  <ng-template>
    <ion-header class="modal-header">
      <ion-toolbar>
        <ion-title>{{ selectedTutorial?.title }}</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeModal()">
            <ion-icon name="close"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    
    <ion-content class="modal-content">
      <div *ngIf="selectedTutorial" class="tutorial-detail">
        <!-- Tutorial Header -->
        <div class="detail-header" [ngClass]="'gradient-' + selectedTutorial.color">
          <div class="header-overlay">
            <ion-icon [name]="selectedTutorial.icon" class="detail-icon"></ion-icon>
            <h1 class="detail-title">{{ selectedTutorial.title }}</h1>
            <p class="detail-subtitle">{{ selectedTutorial.category | titlecase }} • {{ selectedTutorial.duration }} minutos</p>
          </div>
        </div>

        <!-- Tutorial Content -->
        <div class="detail-content">
          <div class="content-section">
            <h3>Descripción</h3>
            <p>{{ selectedTutorial.description }}</p>
          </div>

          <div class="content-section">
            <h3>Lo que aprenderás</h3>
            <ul class="learning-objectives">
              <li *ngFor="let objective of selectedTutorial.objectives">
                <ion-icon name="checkmark-circle" class="text-green-500"></ion-icon>
                {{ objective }}
              </li>
            </ul>
          </div>

          <div class="content-section">
            <h3>Pasos del Tutorial</h3>
            <div class="tutorial-steps">
              <div 
                *ngFor="let step of selectedTutorial.steps; let i = index" 
                class="step-item"
                [class.completed]="step.completed">
                <div class="step-number">{{ i + 1 }}</div>
                <div class="step-content">
                  <h4>{{ step.title }}</h4>
                  <p>{{ step.description }}</p>
                </div>
                <div class="step-status">
                  <ion-icon 
                    [name]="step.completed ? 'checkmark-circle' : 'ellipse-outline'"
                    [class]="step.completed ? 'text-green-500' : 'text-gray-400'">
                  </ion-icon>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tutorial Actions -->
        <div class="tutorial-actions">
          <ion-button 
            expand="block" 
            [ngClass]="'btn-' + selectedTutorial.color"
            (click)="startTutorial(selectedTutorial)">
            <ion-icon name="play-outline" slot="start"></ion-icon>
            {{ selectedTutorial.progress > 0 ? 'Continuar Tutorial' : 'Comenzar Tutorial' }}
          </ion-button>
        </div>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>
